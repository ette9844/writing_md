## 파일 업로드
### 파일 업로드 버튼
```html
<input name="f1" type="file">
```
input type을 file로 설정한다.

업로드 버튼을 포함하고 있는 form 태그의  enctype 속성을 multipart/form-data로 변경해줘야한다. method도 post방식으로 변경.

```html
<!--default-->
<form enctype="application/x-www-form-urlencoded">

<!--multipart/form-data로 변경-->
<form enctype="multipart/form-data"
	  method="post">
```

request.getInputStream() : message body의 내용을 가져온다.


파일 업로드 관련 대표적인 라이브러리는
cos.jar
*Apache Commons Upload*
등이 있다. 

cos.jar는 업로드된 text의 내용과 file의 내용을 구분하기 용이하지만 apache commons upload는 이를 잘 구분하지 못한다.

반면에, 업로드된 파일이 덮어쓰기 되어버려 파일 관리가 Apache Commons Upload 보다 불편하다.


## cos.jar 를 사용한 파일 업로드
[cos maven repository 링크](https://mvnrepository.com/artifact/servlets.com/cos/05Nov2002)

cos.jar의 [MultipartRequest](http://www.servlets.com/cos/javadoc/com/oreilly/servlet/MultipartRequest.html) 클래스의 생성자를 통해 파일 업로드

**MultipartRequest**(javax.servlet.http.HttpServletRequest **request**, java.lang.String **saveDirectory**)

Constructs a new MultipartRequest to handle the specified request, saving any uploaded files to the given directory, and limiting the upload size to 1 Megabyte. If the content is too large, an IOException is thrown. This constructor actually parses the **multipart/form-data** and throws an IOException if there's any problem reading or parsing the request.

**Parameters:**

`request`  - the servlet request.

`saveDirectory`  - the directory in which to save any uploaded files.

**Throws:**

`java.io.IOException`  - if the uploaded content is larger than 1 Megabyte or there's a problem reading or parsing the request.



### 사용 예
servlet.java
```java
protected void doPost(HttpServletRequest request, HttpServletResponse response) 
	throws ServletException, IOException {
	
	String saveDirectory = "files";	// WebContent 하위 폴더명
	String realPath = getServletContext().getRealPath(saveDirectory);	// servlet의 실제 tomcat 구동 경로
	
	MultipartRequest mr = new MultipartRequest(request, realPath);
}
```
>multipartRequest 의 두번째 매개변수에 파일 저장 경로를 설정한다.


### 한글 파일명 깨짐 방지
MultipartRequest(javax.servlet.http.HttpServletRequest request, java.lang.String saveDirectory, java.lang.String **encoding**)

 생성자의 encoding 매개변수를 "UTF-8"로 설정해주면 된다.

```java
String encoding = "UTF-8";
		
MultipartRequest mr = new MultipartRequest(request, realPath, encoding);
```


### 업로드할 수 있는 파일의 용량 결정
MultipartRequest(javax.servlet.http.HttpServletRequest request, java.lang.String saveDirectory, int **maxPostSize**, java.lang.String encoding)

MessageBody 총량(최대량)을 미리 결정해둘 수 있는 생성자

```java
int maxPostSize = 10 * 1024;	// 10 KB
		
MultipartRequest mr = new MultipartRequest(request, realPath, maxPostSize, encoding);
```
<!--stackedit_data:
eyJoaXN0b3J5IjpbLTMxMzU3OTM3NCwtMTE3NDY5ODE1OSwxMD
k2MjUwMTcyLDEyNzk2MzI5ODEsMTc2MTY1MTI0OSwtMTk1NDk1
NzkwOCwxODE2OTA2MDMwLC0yMDg4NzQ2NjEyXX0=
-->